<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧠 FINGER 기반 EF 맞춤 루틴 리포트</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals & Soft Greens -->
    <!-- Application Structure Plan: Upgraded to a 4-section dashboard: 1. EF Profile (Radar Chart), 2. Diagnosis & Problem Summary, 3. The Core Solution (Interactive Tabbed FINGER Routine Breakdown), 4. CTA. The tabbed structure (Food, Move, Cognition, Social) replaces the simple timeline, allowing users to explore the comprehensive, multi-domain routine tailored to their diagnosed EF type (C, B, or D), significantly enhancing the perceived value and utility of the report. -->
    <!-- Visualization & Content Choices: 
    - EF Scores: Goal -> Compare, Inform. Viz -> Interactive Radar Chart (Chart.js/Canvas). Justification -> Visually impactful way to show the imbalance (low R/S/T) that led to the routine assignment. Library -> Chart.js (Canvas).
    - Routine Details: Goal -> Organize, Inform. Presentation -> Tabbed interface using HTML/JS. Justification -> Presents the voluminous FINGER routine data (Diet, Exercise, Cognition, Social) in a clean, navigable structure, avoiding information overload. Method -> HTML/CSS with JS for tab switching.
    - Diagnosis Content: Dynamically updated based on URL parameters to reflect the assigned type (C, B, or D) using data from the uploaded guides. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #FDFBF8; /* Warm Neutral Background */
            color: #4A4A4A;
        }
        .gradient-bg {
            background: linear-gradient(120deg, #fdfbf8 0%, #ebedee 100%);
        }
        .brand-text {
            color: #4a7c59; /* Soft Green */
        }
        .brand-bg {
            background-color: #4a7c59;
        }
        .brand-border {
            border-color: #4a7c59;
        }
        .accent-bg {
            background-color: #fde68a; /* Soft Yellow Accent */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .tab-button.active {
            background-color: #4a7c59;
            color: white;
            border-bottom: 3px solid #fde68a;
        }
        .tab-button {
            transition: all 0.2s ease-in-out;
            min-width: 25%;
        }
    </style>
</head>
<body class="antialiased">
    <div class="min-h-screen">
        <header class="gradient-bg shadow-sm p-6 text-center">
            <h1 class="text-3xl font-bold brand-text">🧠 뇌 실행력(EF) & FINGER 맞춤 리포트</h1>
            <p class="text-lg mt-2">당신의 뇌 유형: <span class="font-semibold" id="diagnosisType">진단 중...</span></p>
        </header>

        <main class="container mx-auto p-4 md:p-8">
            <section id="profile" class="mb-16">
                <h2 class="text-2xl font-bold text-center mb-8">1. EF 프로필 및 핵심 진단</h2>
                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div class="chart-container">
                        <canvas id="efChart"></canvas>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold brand-text mb-4">💡 정원쌤의 맞춤 해설</h3>
                        <div id="diagnosisContent">
                            <p class="text-base leading-relaxed">
                                진단 결과를 불러오는 중입니다. 잠시만 기다려주세요.
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="problems" class="mb-16">
                <h2 class="text-2xl font-bold text-center mb-8">2. 🤯 유형별 현실적인 어려움</h2>
                <div class="grid md:grid-cols-3 gap-6" id="problemCards">
                    <!-- Cards will be populated by JS -->
                </div>
            </section>

            <section id="solution" class="mb-16">
                <h2 class="text-2xl font-bold text-center mb-8">3. 🚀 4주 챌린지 핵심: FINGER 루틴 (맞춤형)</h2>
                <p class="text-center text-gray-600 mb-6">당신의 유형에 최적화된 식단, 운동, 인지, 사회 활동 목표를 확인하세요.</p>
                
                <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-lg">
                    <!-- Tab Buttons -->
                    <div class="flex flex-wrap md:flex-nowrap justify-center border-b border-gray-200 mb-4" id="routineTabs">
                        <button data-tab="food" class="tab-button active flex-1 py-3 px-4 text-sm font-semibold rounded-t-lg">🥗 식단 및 영양</button>
                        <button data-tab="move" class="tab-button flex-1 py-3 px-4 text-sm font-semibold rounded-t-lg">💪 신체 활동</button>
                        <button data-tab="cognition" class="tab-button flex-1 py-3 px-4 text-sm font-semibold rounded-t-lg">🧩 인지 활동</button>
                        <button data-tab="social" class="tab-button flex-1 py-3 px-4 text-sm font-semibold rounded-t-lg">💬 사회 활동</button>
                    </div>

                    <!-- Tab Content -->
                    <div id="routineContent" class="p-4">
                        <!-- Content will be injected here -->
                    </div>
                </div>
            </section>

            <section id="cta" class="text-center bg-white p-8 md:p-12 rounded-lg shadow-xl gradient-bg">
                <h2 class="text-2xl md:text-3xl font-bold mb-4 brand-text">🎁 이 맞춤 루틴을 4주 동안 완성하세요!</h2>
                <p class="max-w-2xl mx-auto mb-8 text-lg">
                    당신의 뇌 유형에 맞춰 설계된 **FINGER 기반 4주 챌린지**로 평생 가는 습관을 자동화하세요.
                </p>
                <button class="brand-bg text-white font-bold py-3 px-8 rounded-full text-lg hover:opacity-90 transition-opacity transform hover:scale-105">
                    ✅ 지금 바로 4주 챌린지 시작하기
                </button>
            </section>
        </main>
        
        <footer class="text-center p-6 mt-12 text-gray-500 text-sm">
            <p>&copy; 2025 브레인 가든. 모든 권리 보유.</p>
            <p>본 리포트는 진단 참고자료이며, 의학적 소견을 대체하지 않습니다.</p>
        </footer>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // 1. URL 파라미터에서 점수 데이터 읽기
        const urlParams = new URLSearchParams(window.location.search);
        
        // R: 억제 통제, S: 작업 기억, T: 인지 유연성, U: 계획/조직
        // parseFloat()으로 소수점 있는 점수 읽기
        const scoreR = parseFloat(urlParams.get('r')) || 2.0; 
        const scoreS = parseFloat(urlParams.get('s')) || 3.0; 
        const scoreT = parseFloat(urlParams.get('t')) || 2.5; 
        const scoreU = parseFloat(urlParams.get('u')) || 4.0; // 계획/조직은 높음 가정
        
        // ** 진단명을 URL 파라미터에서 직접 가져와도 되지만, 
        //    점수가 더 정확하므로 점수를 기반으로 다시 진단합니다.
        
        // 2. 최저점 진단 (R, S, T 세 영역만 사용)
        const scores = [scoreR, scoreS, scoreT];
        const minScore = Math.min(...scores);
        
        let diagnosisType = '진단 오류';
        let diagnosisKey = 'EMOTIONAL'; // Default to EMOTIONAL (C형)

        // 소수점 문제 방지를 위해 반올림하여 비교
        const minScoreRounded = minScore.toFixed(2);
        
        // R -> S -> T 순서로 우선순위 부여 (동점 처리)
        if (scoreR.toFixed(2) === minScoreRounded) {
            diagnosisType = 'C형: 감정적 변화형'; // (억제 통제/감정 조절 취약)
            diagnosisKey = 'EMOTIONAL';
        } else if (scoreS.toFixed(2) === minScoreRounded) {
            diagnosisType = 'B형: 안정적 관리형'; // (작업 기억 취약)
            diagnosisKey = 'STABLE';
        } else if (scoreT.toFixed(2) === minScoreRounded) {
            diagnosisType = 'D형: 소극적 회피형'; // (인지 유연성/회피 취약)
            diagnosisKey = 'AVOIDANT';
        }

        // 3. EF 유형별 상세 데이터 (FINGER 기반 루틴 통합)
        const efData = [
            // C형: 감정적 변화형 (R-억제 통제 최저) - 스트레스, 충동 조절 미루기 문제
            { key: 'EMOTIONAL', name: 'C형: 감정적 변화형', color: 'rose-400', 
                content: `
                    당신의 문제는 **감정 기복**과 **스트레스에 대한 낮은 민감도**입니다. 해야 할 일에 대한 **불안과 두려움**이 생기면, 이를 **미루기(회피 충동)**로 대체하며 실행에 실패합니다. 감정 조절 없이는 어떠한 루틴도 꾸준히 유지할 수 없습니다. (EF 가이드 C형 참조)
                `,
                problems: [
                    { title: '감정적 미루기', desc: '불안/두려움이 발생하면 즉시 쉬운 자극으로 회피합니다.' },
                    { title: '수면 불안정', desc: '스트레스나 감정 기복으로 숙면을 취하기 어렵습니다.' },
                    { title: '충동적 식습관', desc: '감정을 조절하기 위해 소모성 식품(당류, 야식)에 의존합니다.' }
                ],
                routines: {
                    food: `
                        <h4 class="font-bold text-lg mb-2">🥗 혈당 안정화 & 감정 조절 식단</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>**소량 다빈도 식사 (5-6회):** 혈당 급등락을 막아 감정 기복을 최소화합니다.</li>
                            <li>**마그네슘/오메가-3 집중:** 견과류, 연어, 시금치 등 기분 안정 영양소를 매일 섭취합니다.</li>
                            <li>❌ **피할 음식:** 카페인, 정제 설탕, 가공식품 섭취를 최소화합니다.</li>
                        </ul>
                    `,
                    move: `
                        <h4 class="font-bold text-lg mb-2">💪 스트레스 해소 & 감정 배출 운동</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>**매일 아침 (15분):** 호흡 명상 및 요가 스트레칭으로 하루를 안정적으로 시작합니다.</li>
                            <li>**스트레스 발생 시 (5분):** 즉시 자리에서 일어나 심호흡 후 제자리 뛰기 또는 스쿼트를 합니다.</li>
                            <li>**주 3회:** 빠르게 걷기, 에어로빅 등 감정을 배출할 수 있는 유산소 운동을 합니다.</li>
                        </ul>
                    `,
                    cognition: `
                        <h4 class="font-bold text-lg mb-2">🧩 집중력 향상 & 감정 통제 훈련</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>**매일 10분:** 마음챙김 명상(호흡 관찰)을 통해 생각에 휩쓸리지 않도록 훈련합니다.</li>
                            <li>**감정 일기 쓰기:** 오늘 느낀 감정과 그 원인을 기록하여 감정 인지 능력을 높입니다.</li>
                            <li>**컬러링/간단 퍼즐:** 복잡하지 않은 활동으로 집중력을 잠시 확보하여 스트레스를 낮춥니다.</li>
                        </ul>
                    `,
                    social: `
                        <h4 class="font-bold text-lg mb-2">💬 안전한 관계 및 정서적 지지 활동</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>**소규모 만남:** 주 1회 가까운 친구와 조용한 장소에서 만납니다.</li>
                            <li>**안전 지지망:** 가족이나 심리상담을 통해 감정을 안전하게 공유합니다.</li>
                            <li>❌ **주의:** 과도한 자극이 있거나 갈등이 예상되는 대규모 모임은 피합니다.</li>
                        </ul>
                    `
                }
            },
            
            // B형: 안정적 관리형 (S-작업 기억 최저) - 루틴 미망각/재시작 어려움 문제
            { key: 'STABLE', name: 'B형: 안정적 관리형', color: 'amber-400', 
                content: `
                    당신은 **성실성과 꾸준함**을 가졌지만, **새로운 정보나 루틴의 연결 고리가 불안정**합니다. 루틴을 잊지 않고 다음 행동으로 연결하는 **'뇌의 메모장'** 용량이 약해 실행 모멘텀을 자주 잃습니다. 훌륭한 계획을 실행까지 완벽하게 이어주는 훈련이 핵심입니다. (EF 가이드 B형 참조)
                `,
                problems: [
                    { title: '미션 망각', desc: '해야 할 루틴을 정해놓고도, 특정 시간에 떠올리지 못해 실행에 실패합니다.' },
                    { title: '정보 누락', desc: '여러 지시나 단계를 순서대로 기억하지 못하고, 중요한 단계를 빼먹습니다.' },
                    { title: '루틴 재시작 어려움', desc: '한번 놓친 루틴을 다시 시작하는 데 큰 에너지가 소모됩니다.' }
                ],
                routines: {
                    food: `
                        <h4 class="font-bold text-lg mb-2">🥗 규칙적이고 간편한 고정 식단</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>**일주일 고정 메뉴:** 매일 메뉴를 고민하는 대신, 건강한 옵션으로 일주일치 고정 메뉴를 만들어 반복합니다.</li>
                            <li>**식사 시간 고정:** 매일 같은 시간에 식사하여 뇌가 안정된 패턴을 유지하게 합니다.</li>
                            <li>**주말 재료 준비:** 주말에 식재료를 미리 손질하여 평일의 실행 부담을 줄입니다.</li>
                        </ul>
                    `,
                    move: `
                        <h4 class="font-bold text-lg mb-2">💪 규칙적이고 반복 가능한 고정 운동</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>**고정 시간/장소:** 매일 오전 7시 등, 운동 시간과 장소를 고정하여 습관 자동화를 유도합니다.</li>
                            <li>**같은 동작 반복:** 같은 근력 운동(스쿼트, 벽 팔굽혀펴기 등)을 반복하여 숙련도를 높입니다.</li>
                            <li>**체크리스트:** 매일 운동 완료 후 체크리스트에 기록하여 성실성을 유지합니다.</li>
                        </ul>
                    `,
                    cognition: `
                        <h4 class="font-bold text-lg mb-2">🧩 부담 없는 단계적 인지 훈련</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>**기억력 게임:** 숫자 외우기, 카드 짝 맞추기 등 부담 없는 난이도로 시작합니다.</li>
                            <li>**단계적 난이도 증가:** 십자말 퍼즐이나 스도쿠의 난이도를 점진적으로 올립니다.</li>
                            <li>**독서:** 주 3회 이상 꾸준히 독서하며 기억력과 언어 유창성을 유지합니다.</li>
                        </ul>
                    `,
                    social: `
                        <h4 class="font-bold text-lg mb-2">💬 안정적인 관계 유지 활동</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>**정기적 만남:** 매주 화요일 친구, 목요일 복지관 활동 등 정기적인 약속을 만듭니다.</li>
                            <li>**가족 모임:** 주 1회 이상 가족 모임을 통해 안정적인 정서적 지지를 확보합니다.</li>
                            <li>**봉사 동아리:** 꾸준한 참여가 가능한 정기 봉사 활동에 집중합니다.</li>
                        </ul>
                    `
                }
            },
            
            // D형: 소극적 회피형 (T-인지 유연성 최저) - 새로운 도전, 변화에 대한 회피 문제
            { key: 'AVOIDANT', name: 'D형: 소극적 회피형', color: 'sky-400', 
                content: `
                    당신은 **새로운 상황이나 낯선 환경**을 피하려는 경향이 강해 인지적 유연성이 낮습니다. 이 때문에 치매 예방에 필수적인 **새로운 도전(새로운 취미, 새로운 길)**을 회피하고 일상의 매너리즘에 갇히기 쉽습니다. 루틴을 성공하려면 **안전하고 점진적인 변화**가 필요합니다. (EF 가이드 D형 참조)
                `,
                problems: [
                    { title: '새로운 학습 회피', desc: '새로운 취미나 외국어 학습 등 뇌에 필요한 도전을 시도하기 어렵습니다.' },
                    { title: '문제 해결 경직성', desc: '계획대로 되지 않을 때 다른 대안을 찾지 못하고 한 가지 방식만 고집합니다.' },
                    { title: '사회적 고립 위험', desc: '낮은 외향성으로 인해 외부 활동을 줄여 사회적 지지망이 약화될 수 있습니다.' }
                ],
                routines: {
                    food: `
                        <h4 class="font-bold text-lg mb-2">🥗 간편하고 부담 없는 홈 식단</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>**초간편 식단 옵션:** 복잡한 요리 대신 통곡물 시리얼, 토스트 등 3가지 메뉴 옵션으로 식사를 단순화합니다.</li>
                            <li>**온라인 장보기:** 외부 활동 부담을 줄이기 위해 온라인으로 식재료를 주문합니다.</li>
                            <li>**간편식 활용:** 건강한 옵션 내에서 주 2회 배달/간편식 활용을 허용합니다.</li>
                        </ul>
                    `,
                    move: `
                        <h4 class="font-bold text-lg mb-2">💪 집에서 혼자 할 수 있는 홈 트레이닝</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>**유튜브 영상 활용:** 50대 홈 트레이닝 영상을 찾아 실내에서 반복하여 운동합니다.</li>
                            <li>**요가/스트레칭:** 실내에서 편안하게 할 수 있는 이완 운동을 주로 합니다.</li>
                            <li>**점진적 산책:** 3-4주차부터 매일 10분, 사람 적은 시간대에 산책을 시작합니다.</li>
                        </ul>
                    `,
                    cognition: `
                        <h4 class="font-bold text-lg mb-2">🧩 집에서 편안하게 즐기는 인지 훈련</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>**모바일 앱/종이 활동:** 루모시티 같은 뇌 훈련 앱이나 십자말 퍼즐 등 편안한 활동을 선택합니다.</li>
                            <li>**독서/오디오북:** 좋아하는 장르 위주로 독서하며 기억력과 언어 유창성을 유지합니다.</li>
                            <li>**TV 퀴즈 활용:** 퀴즈 프로그램을 시청하며 집에서 혼자 답을 맞춰봅니다.</li>
                        </ul>
                    `,
                    social: `
                        <h4 class="font-bold text-lg mb-2">💬 안전하고 점진적인 사회 연결 활동</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>**온라인 연결 (1-2주차):** 가족과 영상통화, 온라인 카페 댓글 소통부터 시작합니다.</li>
                            <li>**소규모 대면 (3-4주차):** 가까운 가족 1-2명과 짧고 익숙한 장소에서 만납니다.</li>
                            <li>**안전 장치:** 활동 전에 미리 계획하고, 언제든 떠날 수 있는 탈출구를 확보합니다.</li>
                        </ul>
                    `
                }
            }
        ];

        const currentProfile = efData.find(p => p.key === diagnosisKey) || efData[0];
        
        // 4. 동적 콘텐츠 업데이트
        document.getElementById('diagnosisType').textContent = currentProfile.name;
        document.getElementById('diagnosisContent').innerHTML = `
             <p class="text-base leading-relaxed">${currentProfile.content}</p>
        `;
        document.querySelector('#problems h2').textContent = `2. 🤯 '${currentProfile.name}'의 현실적인 어려움`;


        // 5. 문제점 카드 렌더링
        const problemCardsContainer = document.getElementById('problemCards');
        problemCardsContainer.innerHTML = currentProfile.problems.map((p, index) => `
             <div class="card bg-white p-6 rounded-lg shadow-md border-l-4 border-${currentProfile.color}">
                <h3 class="text-lg font-bold mb-2">${p.title}</h3>
                <p>${p.desc}</p>
            </div>
        `).join('');

        // 6. FINGER 루틴 탭 콘텐츠 렌더링
        const routineContentContainer = document.getElementById('routineContent');
        const tabButtons = document.querySelectorAll('#routineTabs .tab-button');

        function renderRoutineContent(key) {
            routineContentContainer.innerHTML = currentProfile.routines[key];
        }

        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                tabButtons.forEach(btn => btn.classList.remove('active'));
                // Add active class to the clicked button
                this.classList.add('active');
                
                renderRoutineContent(this.getAttribute('data-tab'));
            });
        });

        // Initialize with the first tab content (Food)
        renderRoutineContent('food');

        // 7. 차트 렌더링
        const ctx = document.getElementById('efChart').getContext('2d');
        
        const chartData = {
            labels: ['억제 통제 (R)', '계획/조직 (U)', '인지 유연성 (T)', '작업 기억 (S)'],
            datasets: [{
                label: '나의 EF 프로필',
                data: [scoreR, scoreU, scoreT, scoreS], 
                fill: true,
                backgroundColor: 'rgba(74, 124, 89, 0.2)',
                borderColor: 'rgba(74, 124, 89, 1)',
                pointBackgroundColor: 'rgba(74, 124, 89, 1)',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgba(74, 124, 89, 1)'
            }]
        };

        const config = {
            type: 'radar',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                elements: {
                    line: {
                        borderWidth: 3
                    }
                },
                scales: {
                    r: {
                        angleLines: {
                            display: true,
                            color: 'rgba(0, 0, 0, 0.1)'
                        },
                        suggestedMin: 1, 
                        suggestedMax: 5, 
                        ticks: {
                           stepSize: 1,
                           backdropColor: 'rgba(253, 251, 248, 0.75)'
                        },
                        pointLabels: {
                            font: {
                                size: 14,
                                weight: 'bold'
                            },
                            color: '#4A4A4A'
                        },
                        grid: {
                           color: 'rgba(0, 0, 0, 0.1)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.r !== null) {
                                    label += context.parsed.r.toFixed(2) + '점'; 
                                }
                                return label;
                            }
                        }
                    }
                }
            },
        };

        new Chart(ctx, config);
    });
</script>

</body>
</html>

